<html>

<head>
    <script type="text/javascript" src="maze.js"></script>
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
</head>

<body>
    <div id="inputs">
        <label for="width">Width:</label>
        <input type="text" id="width" value="100">
        <label for="height">Height:</label>
        <input type="text" id="height" value="100">
        <label for="complexity">Complexity:</label>
        <input type="text" id="complexity" value="0.75">
        <label for="density">Density:</label>
        <input type="text" id="density" value="0.3">
        <label for="choice">Shape:</label>
        <select id="choice">
            <option value="square">Square</option>
            <option value="circle">Circle</option>
        </select>

    </div>
    <div>
        More complexity means less big rooms. </br>
        More density means more squares.</br>
        <input id="generate" type="submit" value='Generate'>
        <input id="download" type="submit" value='Download as CSV'>
    </div>
    <div id='myChart'></div>
</body>

<script>
    function updateChart(width, height, complexity, density) {

        markerShape = String($('#choice').val());

        if (density > 1 || complexity > 1) {
            alert("please set density and complexity to less than 1");
            return false;
        }

        if (width * height > 100 * 200) {
            alert("Please set product of width and height to less than 20000");
            return false;
        }

        maze = makeMaze(width, height, complexity, density);
        points = mazePoints(maze);
        scaleHeight = height * 1 + 1;
        var myConfig1 = {
            type: "scatter",
            'scale-x': {
                values: "0:" + width + ":1",
            },
            'scale-y': {
                values: "0:" + scaleHeight + ":1",
            },
            plot: {
                marker: {
                    size: 8.4,
                    type: markerShape,
                    borderColor: "blue",
                    backgroundColor: "blue",
                },
            },
            series: [{
                values: points
            }]
        };

        zingchart.render({
            id: 'myChart',
            data: myConfig1,
            height: "900px",
            width: "900px"
        });
    }

    $('#generate').click(function () {
        width = $('#width').val();
        height = $('#height').val();
        complexity = $('#complexity').val();
        density = $('#density').val();

        updateChart(width, height, complexity, density);
    });

    $('#download').click(function () {
        downloadExcel(points);
    });

    $(document).ready(function () {
        width = $('#width').val();
        height = $('#height').val();
        complexity = $('#complexity').val();
        density = $('#density').val();

        updateChart(width, height, complexity, density);
    });

    function downloadExcel(points) {
        var tableHeaders = ["x", "y"];

        //now a container for the excel data i.e. tableHeaders+datacreated:
        var dataTable = new Array();
        dataTable.push(tableHeaders);

        //now looping around the data
        points.forEach(function (col) {
            dataTable.push(col);
        });

        //now converting the array given into a `csv` content
        let csvContent = "data:text/csv;charset=utf-8,";
        dataTable.forEach(function (rowArray) {
            let row = rowArray.join(",");
            csvContent += row + "\r\n";
        });

        //calling the csv download via anchor tag(link) so we can provide a name for the file
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.style.display = 'none';
        link.setAttribute("download", "myCSV.csv"); //change it to give your own name
        link.innerHTML = "Click Here to download";
        document.body.appendChild(link); // Required for FF

        link.click();
        link.remove(); //removing the link after the download
    }
</script>

</html>